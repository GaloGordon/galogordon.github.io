<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Calculadora TP/SL · Mi Sitio</title>
  <link rel="stylesheet" href="/assets/style.css">
  <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body>
  <div class="container">
    <div class="nav">
      <div class="brand"><a href="/"><span style="color:#22c55e">></span> Mi Sitio</a></div>
      <div style="display:flex;gap:.25rem;flex-wrap:wrap">
        <a href="/index.html">Inicio</a>
        <a href="/about.html">Sobre mí</a>
        <a href="/cv.html">Currículum</a>
        <a href="/tools/calculadora-tp-sl.html">Herramientas</a>
      </div>
    </div>
    <div id="root"></div>
    <div class="footer">© 2025 · Mi Sitio</div>
  </div>

  <script type="text/babel">
    const {{ useMemo, useState }} = React;

    function Row({{ label, value, highlight }}) {{
      return (
        <div className="flex items-center justify-between gap-4" style={{borderBottom:"1px solid #1f2937", padding:"8px 0"}}>
          <span style={{color:"#94a3b8"}}>{label}</span>
          <span style={{fontWeight:600, color: highlight==="pos" ? "#16a34a" : (highlight==="neg" ? "#ef4444" : "#fff")}}>{value}</span>
        </div>
      );
    }}

    function PerpRiskCalculator() {{
      const [side, setSide] = useState("Long");
      const [entry, setEntry] = useState(30000);
      const [stop, setStop] = useState(28800);
      const [takeProfit, setTakeProfit] = useState(31200);
      const [margin, setMargin] = useState(1000);
      const [leverage, setLeverage] = useState(10);

      const fmt = (n, opts = {{}}) => new Intl.NumberFormat(undefined, opts).format(isFinite(n) ? n : 0);

      const calc = useMemo(() => {{
        const valid = entry > 0 && leverage > 0 && margin > 0;
        if (!valid) return null;
        const positionSize = margin * leverage;
        const qty = positionSize / entry;
        const slDiff = side === "Long" ? entry - stop : stop - entry;
        const tpDiff = side === "Long" ? takeProfit - entry : entry - takeProfit;
        const slPct = (slDiff / entry) * 100;
        const tpPct = (tpDiff / entry) * 100;
        const pnlAtSL = -qty * slDiff;
        const pnlAtTP = qty * tpDiff;
        const riskPctOfMargin = (pnlAtSL / margin) * 100;
        const rewardPctOfMargin = (pnlAtTP / margin) * 100;
        const rr = tpDiff > 0 && slDiff > 0 ? Math.abs(pnlAtTP / Math.abs(pnlAtSL)) : NaN;
        const approxLiq = side === "Long" ? entry * (1 - 1 / leverage) : entry * (1 + 1 / leverage);
        const slVsLiq = side === "Long" ? stop - approxLiq : approxLiq - stop;
        return {{ positionSize, qty, slDiff, tpDiff, slPct, tpPct, pnlAtSL, pnlAtTP, riskPctOfMargin, rewardPctOfMargin, rr, approxLiq, slVsLiq }};
      }}, [entry, stop, takeProfit, margin, leverage, side]);

      const inputCls = "width:100%;padding:12px 14px;border-radius:14px;border:1px solid #1f2937;background:#0b1220;color:#e5e7eb;outline:none";

      return (
        <div className="grid" style={{gap:"16px"}}>
          <div className="card">
            <h1>Calculadora de TP/SL (Perps)</h1>
            <p style={{color:"#94a3b8"}}>Introduce entrada, stop, take profit, margen y apalancamiento. Cálculo de tamaño de posición, riesgo/beneficio y <i>liq. aproximada</i>.</p>
          </div>
          <div className="grid grid-2">
            <div className="card">
              <h2>Entradas</h2>
              <div style={{display:"grid", gap:"10px"}}>
                <div>
                  <small style={{color:"#94a3b8"}}>Lado</small><br/>
                  <div style={{display:"flex", gap:"8px", marginTop:"6px"}}>
                    <button onClick={() => setSide("Long")} className="btn" style={{background: side==="Long" ? "linear-gradient(90deg,#22c55e,#38bdf8)" : "none", border: "1px solid #1f2937"}}>Long</button>
                    <button onClick={() => setSide("Short")} className="btn" style={{background: side==="Short" ? "linear-gradient(90deg,#22c55e,#38bdf8)" : "none", border: "1px solid #1f2937"}}>Short</button>
                  </div>
                </div>
                <label>
                  <small style={{color:"#94a3b8"}}>Precio de entrada</small><br/>
                  <input type="number" value={entry} onChange={e=>setEntry(Number(e.target.value))} style={{{"width":"100%","padding":"12px 14px","borderRadius":"14px","border":"1px solid #1f2937","background":"#0b1220","color":"#e5e7eb","outline":"none"}}} />
                </label>
                <label>
                  <small style={{color:"#94a3b8"}}>Stop loss</small><br/>
                  <input type="number" value={stop} onChange={e=>setStop(Number(e.target.value))} style={{{"width":"100%","padding":"12px 14px","borderRadius":"14px","border":"1px solid #1f2937","background":"#0b1220","color":"#e5e7eb","outline":"none"}}} />
                </label>
                <label>
                  <small style={{color:"#94a3b8"}}>Take profit</small><br/>
                  <input type="number" value={takeProfit} onChange={e=>setTakeProfit(Number(e.target.value))} style={{{"width":"100%","padding":"12px 14px","borderRadius":"14px","border":"1px solid #1f2937","background":"#0b1220","color":"#e5e7eb","outline":"none"}}} />
                </label>
                <label>
                  <small style={{color:"#94a3b8"}}>Margen ($)</small><br/>
                  <input type="number" value={margin} onChange={e=>setMargin(Number(e.target.value))} style={{{"width":"100%","padding":"12px 14px","borderRadius":"14px","border":"1px solid #1f2937","background":"#0b1220","color":"#e5e7eb","outline":"none"}}} />
                </label>
                <label>
                  <small style={{color:"#94a3b8"}}>Apalancamiento</small><br/>
                  <input type="range" min="1" max="100" value={leverage} onChange={e=>setLeverage(Number(e.target.value))} />
                  <div style={{marginTop:"4px"}}><b>{'{'}{'}'}{leverage}{'{'}{'}'}x</b></div>
                </label>
              </div>
            </div>
            <div className="card">
              <h2>Métricas</h2>
              { '{' }calc ? (
                <div style={{display:"grid", gap:"8px"}}>
                  <Row label="Lado" value={ '{' }side{ '}' } />
                  <Row label="Tamaño posición" value={ '{' }`$${'{'}new Intl.NumberFormat().format(calc.positionSize){'}'}`{ '}' } />
                  <Row label="Cantidad" value={ '{' }`${'{'}new Intl.NumberFormat(undefined, {{ maximumFractionDigits: 6 }}).format(calc.qty){'}'} coins`{ '}' } />
                  <Row label="Movimiento hasta SL" value={ '{' }`${'{'}calc.slDiff.toFixed(2){'}'} (${ '{'}calc.slPct.toFixed(2){'}'}%)`{ '}' } />
                  <Row label="Movimiento hasta TP" value={ '{' }`${'{'}calc.tpDiff.toFixed(2){'}'} (${ '{'}calc.tpPct.toFixed(2){'}'}%)`{ '}' } />
                  <Row label="PnL @ SL" value={ '{' }`$${'{'}calc.pnlAtSL.toFixed(2){'}'}`{ '}' } highlight="neg" />
                  <Row label="PnL @ TP" value={ '{' }`$${'{'}calc.pnlAtTP.toFixed(2){'}'}`{ '}' } highlight="pos" />
                  <Row label="Riesgo % del margen" value={ '{' }`${'{'}calc.riskPctOfMargin.toFixed(2){'}'}%`{ '}' } highlight="neg" />
                  <Row label="Recompensa % del margen" value={ '{' }`${'{'}calc.rewardPctOfMargin.toFixed(2){'}'}%`{ '}' } highlight="pos" />
                  <Row label="R : R" value={ '{' }isFinite(calc.rr) ? `${'{'}calc.rr.toFixed(2){'}'} : 1` : "–"{ '}' } />
                </div>
              ) : <p style={{color:"#94a3b8"}}>Completa los campos.</p> }
            </div>
          </div>
          <div className="card">
            <h2>Seguridad</h2>
            { '{' }calc ? (
              <div style={{display:"grid", gap:"8px"}}>
                <Row label="Liq. aproximada" value={ '{' }`$${'{'}calc.approxLiq.toFixed(2){'}'}`{ '}' } />
                <Row label="SL vs Liq." value={ '{' }`${'{'}(calc.slVsLiq>=0?'+':''){'}'}${'{'}calc.slVsLiq.toFixed(2){'}'}`{ '}' } highlight={ '{' }calc.slVsLiq<0?'neg':undefined{ '}' } />
                <p style={{color:"#94a3b8",fontSize:".9rem"}}>La liquidación es una <b>aproximación</b> (no incluye margen de mantenimiento, funding ni comisiones). Comprueba la cifra oficial en tu exchange.</p>
              </div>
            ) : <p style={{color:"#94a3b8"}}>Introduce valores para calcular.</p> }
          </div>
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById("root")).render(<PerpRiskCalculator/>);
  </script>
</body>
</html>
